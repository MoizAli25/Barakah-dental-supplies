<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Profile - Barakah Dental Supplies</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="assets/css/style.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Responsive card styling like blog page */
    .profile-card, .item-card {
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #e4e4e4;
    }

    .item-card .card-body {
      padding: 1rem;
    }

    .accordion-button {
      font-size: 1rem;
    }

    .item-quantity-input {
      max-width: 80px;
      width: 100%;
    }

    @media (max-width: 576px) {
      .accordion-button {
        font-size: 0.95rem;
      }
      .item-quantity-input {
        max-width: 100%;
      }
      .card.mb-2 {
        padding: 0.8rem;
      }
    }
  </style>
</head>
<body>

<!-- NAVBAR (same as blog page) -->
<nav class="navbar navbar-expand-lg navbar-light custom-nav rounded-nav">
  <div class="container justify-content-center">
    <div class="nav-box shadow-lg">
      <a class="navbar-brand d-flex align-items-center" href="index.html">
        <img src="assets/images/LOGO.png" alt="Barakah Logo" class="nav-logo">
      </a>
      <button class="navbar-toggler custom-toggler collapsed text-white" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
        <span class="toggler-icon">âœš</span>
      </button>
      <div class="collapse navbar-collapse animate__animated animate__fadeInDown" id="navMenu">
        <ul class="navbar-nav ms-auto align-items-lg-center">
          <li class="nav-item"><a class="nav-link nav-anim" href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link nav-anim" href="products.html">Products</a></li>
          <li class="nav-item"><a class="nav-link nav-anim" href="about.html">About</a></li>
          <li class="nav-item"><a class="nav-link nav-anim" href="blog.html">Blog</a></li>
          <li class="nav-item"><a class="nav-link nav-anim" href="contact.html">Contact</a></li>
          <li class="nav-item"><a class="nav-link nav-anim" href="profile.html">Profile</a></li>
          <li class="nav-item ms-2"><a class="btn btn-light login-btn" id="loginBtn" href="login.html">Login</a></li>
          <li class="nav-item ms-2">
            <a class="btn btn-outline-light cart-btn position-relative" href="cart.html">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-cart3">
                <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.401l-9.397.472L4.415 11H13a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5M3.102 4l.84 4.479 9.144-.459L13.89 4zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4m7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4m-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2m7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/>
              </svg>
              <span id="cart-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
            </a>
          </li>
          <li class="nav-item ms-2 d-none" id="logoutBtnContainer">
            <button class="btn btn-danger" id="logoutBtn">Logout</button>
          </li>
        </ul>
      </div>
    </div>
  </div>
</nav>

<!-- PROFILE CARD -->
<div class="container mt-5">
  <div class="card p-4 shadow border-0 profile-card" style="max-width:600px; margin:auto;">
    <h3 class="mb-3 text-center">Your Profile</h3>
    <p><strong>Name:</strong> <span id="userName"></span></p>
    <p><strong>Email:</strong> <span id="userEmail"></span></p>
    <p><strong>Role:</strong> <span id="userRole"></span></p>
  </div>
</div>

<!-- USER ITEMS -->
<div class="container mt-4">
  <h4 class="text-center mb-3">Your Items</h4>
  <div class="accordion" id="userItemsAccordion">

    <!-- Cart Items -->
    <div class="accordion-item">
      <h2 class="accordion-header" id="cartHeading">
        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#cartItems">
          Cart Items
        </button>
      </h2>
      <div id="cartItems" class="accordion-collapse collapse show" data-bs-parent="#userItemsAccordion">
        <div class="accordion-body" id="cartList"></div>
      </div>
    </div>

    <!-- Orders -->
    <div class="accordion-item">
      <h2 class="accordion-header" id="ordersHeading">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#orderItems">
          Orders
        </button>
      </h2>
      <div id="orderItems" class="accordion-collapse collapse" data-bs-parent="#userItemsAccordion">
        <div class="accordion-body" id="ordersList"></div>
      </div>
    </div>

    <!-- Wishlist -->
    <div class="accordion-item">
      <h2 class="accordion-header" id="wishlistHeading">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#wishlistItems">
          Wishlist
        </button>
      </h2>
      <div id="wishlistItems" class="accordion-collapse collapse" data-bs-parent="#userItemsAccordion">
        <div class="accordion-body" id="wishlistList"></div>
      </div>
    </div>

  </div>
</div>

<script>
  const session = JSON.parse(localStorage.getItem("session"));
  if (!session) window.location.href = "login.html";

  document.getElementById("userName").innerText = session.name;
  document.getElementById("userEmail").innerText = session.email;
  document.getElementById("userRole").innerText = session.role;

  document.getElementById("loginBtn").classList.add("d-none");
  document.getElementById("logoutBtnContainer").classList.remove("d-none");
  document.getElementById("logoutBtn").addEventListener("click", () => {
    localStorage.removeItem("session");
    window.location.href = "login.html";
  });

  let cartItems = JSON.parse(localStorage.getItem("cart")) || [];
  let orders = JSON.parse(localStorage.getItem("orders")) || [];
  let wishlist = JSON.parse(localStorage.getItem("wishlist")) || [];

  function renderItems(list, containerId, type) {
    const container = document.getElementById(containerId);
    if (list.length === 0) {
      container.innerHTML = "<p class='text-muted'>No items found.</p>";
      return;
    }

    container.innerHTML = list.map((item, index) => {
      let buttons = '';
      let quantityInput = '';
      if (type === 'cart') {
        quantityInput = `<input type="number" min="1" value="${item.quantity || 1}" onchange="updateQuantity(${index}, this.value)" class="form-control form-control-sm mb-2 item-quantity-input">`;
        buttons = `<button class="btn btn-sm btn-danger me-2" onclick="removeItem('cart', ${index})">Remove</button>`;
      } else if (type === 'wishlist') {
        buttons = `<a href="product-details.html?id=${item.id}" class="btn btn-sm btn-primary">View Details</a>
                   <button class="btn btn-sm btn-danger ms-2" onclick="removeItem('wishlist', ${index})">Remove</button>`;
      } else if (type === 'orders') {
        buttons = `<button class="btn btn-sm btn-primary" onclick="viewOrder(${index})">View Details</button>`;
      }

      return `
        <div class="card mb-2 item-card">
          <div class="card-body">
            <strong>${item.title}</strong><br>
            ${quantityInput}
            ${buttons}
          </div>
        </div>
      `;
    }).join('');
  }

  function removeItem(type, index) {
    if (type === 'cart') {
      cartItems.splice(index, 1);
      localStorage.setItem('cart', JSON.stringify(cartItems));
      renderItems(cartItems, 'cartList', 'cart');
      document.getElementById("cart-count").innerText = cartItems.length;
    } else if (type === 'wishlist') {
      wishlist.splice(index, 1);
      localStorage.setItem('wishlist', JSON.stringify(wishlist));
      renderItems(wishlist, 'wishlistList', 'wishlist');
    }
  }

  function updateQuantity(index, value) {
    const qty = parseInt(value);
    if (qty < 1) return;
    cartItems[index].quantity = qty;
    localStorage.setItem('cart', JSON.stringify(cartItems));
    renderItems(cartItems, 'cartList', 'cart');
    document.getElementById("cart-count").innerText = cartItems.length;
  }

  function viewOrder(index) {
    const order = orders[index];
    alert(`Order Details:\n\nName: ${order.name}\nQuantity: ${order.quantity}\nPrice: $${order.price}`);
  }

  renderItems(cartItems, "cartList", "cart");
  renderItems(orders, "ordersList", "orders");
  renderItems(wishlist, "wishlistList", "wishlist");
  document.getElementById("cart-count").innerText = cartItems.length;
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
